<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kanapy.api &mdash; kanapy 5.0.3 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f98c4cc8"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            kanapy
          </a>
              <div class="version">
                5.0.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../method.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kanapy.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">kanapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">kanapy.api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kanapy.api</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; Module defining class Microstructure that contains the necessary</span>
<span class="sd">methods and attributes to analyze experimental microstructures in form</span>
<span class="sd">of EBSD maps to generate statistical descriptors for 3D microstructures, and </span>
<span class="sd">to create synthetic RVE that fulfill the requires statistical microstructure</span>
<span class="sd">descriptors.</span>

<span class="sd">The methods of the class Microstructure for an API that can be used to generate</span>
<span class="sd">Python workflows.</span>

<span class="sd">Authors: Alexander Hartmaier, Golsa Tolooei Eshlghi, Abhishek Biswas</span>
<span class="sd">Institution: ICAMS, Ruhr University Bochum</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>

<span class="kn">from</span> <span class="nn">kanapy.grains</span> <span class="kn">import</span> <span class="n">calcPolygons</span><span class="p">,</span> <span class="n">get_stats</span>
<span class="kn">from</span> <span class="nn">kanapy.input_output</span> <span class="kn">import</span> <span class="n">export2abaqus</span>
<span class="kn">from</span> <span class="nn">kanapy.initializations</span> <span class="kn">import</span> <span class="n">particleStatGenerator</span><span class="p">,</span> <span class="n">RVEcreator</span>
<span class="kn">from</span> <span class="nn">kanapy.packing</span> <span class="kn">import</span> <span class="n">packingRoutine</span>
<span class="kn">from</span> <span class="nn">kanapy.voxelization</span> <span class="kn">import</span> <span class="n">voxelizationRoutine</span>
<span class="kn">from</span> <span class="nn">kanapy.smoothingGB</span> <span class="kn">import</span> <span class="n">smoothingRoutine</span>
<span class="kn">from</span> <span class="nn">kanapy.plotting</span> <span class="kn">import</span> <span class="n">plot_voxels_3D</span><span class="p">,</span> <span class="n">plot_ellipsoids_3D</span><span class="p">,</span> \
    <span class="n">plot_polygons_3D</span><span class="p">,</span> <span class="n">plot_output_stats</span>


<div class="viewcode-block" id="Microstructure">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure">[docs]</a>
<span class="k">class</span> <span class="nc">Microstructure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Define class for synthetic microstructures&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descriptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Microstructure&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simbox</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_s</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elmtSetDict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">descriptor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please provide either a dictionary with statistics or an input file name&#39;</span><span class="p">)</span>

            <span class="c1"># Open the user input statistics file and read the data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">descriptor</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;File: &#39;</span><span class="si">{}</span><span class="s2">&#39; does not exist in the current working directory!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">descriptor</span> <span class="o">==</span> <span class="s1">&#39;from_voxels&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">descriptor</span> <span class="o">=</span> <span class="p">[</span><span class="n">descriptor</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">descriptor</span> <span class="o">=</span> <span class="n">descriptor</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Input parameter (descriptor) and file are given. Only descriptor will be used.&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --------        Routines for user interface        --------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Microstructure.init_stats">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.init_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">init_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descriptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gs_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ar_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">porous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates particle statistics based on the data provided in the </span>
<span class="sd">        input file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">descriptor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">descriptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">descriptor</span> <span class="o">=</span> <span class="p">[</span><span class="n">descriptor</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nphase</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nphase</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Kanapy currently only supports 2 phases, but Nphase=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nphase</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">porous</span><span class="p">:</span>
            <span class="n">descriptor</span> <span class="o">=</span> <span class="n">descriptor</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">gs_data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">gs_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">gs_data</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ar_data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">ar_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">ar_data</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">des</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">descriptor</span><span class="p">):</span>
            <span class="n">particleStatGenerator</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="n">gs_data</span><span class="o">=</span><span class="n">gs_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ar_data</span><span class="o">=</span><span class="n">ar_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                  <span class="n">save_files</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.init_RVE">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.init_RVE">[docs]</a>
    <span class="k">def</span> <span class="nf">init_RVE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descriptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">porous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Creates particle distribution inside simulation box (RVE) based on</span>
<span class="sd">        the data provided in the input file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">descriptor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">descriptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptor</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">descriptor</span> <span class="o">=</span> <span class="p">[</span><span class="n">descriptor</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">porous</span><span class="p">:</span>
            <span class="n">descriptor</span> <span class="o">=</span> <span class="n">descriptor</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">des</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">descriptor</span><span class="p">):</span>
            <span class="n">particle_data</span><span class="p">,</span> <span class="n">phases</span><span class="p">,</span> <span class="n">RVE_data</span><span class="p">,</span> <span class="n">simulation_data</span> <span class="o">=</span> \
                <span class="n">RVEcreator</span><span class="p">(</span><span class="n">des</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="n">nsteps</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span>
            <span class="n">Ngr</span> <span class="o">=</span> <span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span> <span class="o">=</span> <span class="n">Ngr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span> <span class="o">=</span> <span class="n">particle_data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phases</span> <span class="o">=</span> <span class="n">phases</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span> <span class="o">=</span> <span class="n">RVE_data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="n">simulation_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">des</span><span class="p">[</span><span class="s1">&#39;Grain type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Elongated&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span> <span class="o">+=</span> <span class="n">Ngr</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;This needs to be stored in a phase-specific way&quot;&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Equivalent_diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Equivalent_diameter&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                                                <span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Equivalent_diameter&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Major_diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Major_diameter&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">particle_data</span><span class="p">[</span>
                        <span class="s1">&#39;Major_diameter&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Minor_diameter1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Minor_diameter1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">particle_data</span><span class="p">[</span>
                        <span class="s1">&#39;Minor_diameter1&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Minor_diameter2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Minor_diameter2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">particle_data</span><span class="p">[</span>
                        <span class="s1">&#39;Minor_diameter2&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase name&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Tilt angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Tilt angle&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Tilt angle&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">des</span><span class="p">[</span><span class="s1">&#39;Grain type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Equiaxed&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span> <span class="o">+</span> <span class="n">Ngr</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Equivalent_diameter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Equivalent_diameter&#39;</span><span class="p">]</span> <span class="o">+</span> \
                                                                <span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Equivalent_diameter&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">particle_data</span><span class="p">[</span><span class="s1">&#39;Number&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase name&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">]</span></div>

            <span class="c1"># if both Equiaxed and Elongated grains are present at the same time, it should be adjusted.</span>

<div class="viewcode-block" id="Microstructure.pack">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.pack">[docs]</a>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particle_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">RVE_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">simulation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">k_rep</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">k_att</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot; Packs the particles into a simulation box.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">particle_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">particle_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span>
            <span class="k">if</span> <span class="n">particle_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No particle_data in pack. Run create_RVE first.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">RVE_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">RVE_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span>
        <span class="k">if</span> <span class="n">simulation_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">simulation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simbox</span> <span class="o">=</span> \
            <span class="n">packingRoutine</span><span class="p">(</span><span class="n">particle_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">,</span> <span class="n">RVE_data</span><span class="p">,</span>
                           <span class="n">simulation_data</span><span class="p">,</span>
                           <span class="n">k_rep</span><span class="o">=</span><span class="n">k_rep</span><span class="p">,</span> <span class="n">k_att</span><span class="o">=</span><span class="n">k_att</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="n">vf</span><span class="p">,</span>
                           <span class="n">save_files</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.voxelize">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.voxelize">[docs]</a>
    <span class="k">def</span> <span class="nf">voxelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particle_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">RVE_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">particles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">simbox</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates the RVE by assigning voxels to grains.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">particle_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">particle_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span>
        <span class="k">if</span> <span class="n">RVE_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">RVE_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span>
        <span class="k">if</span> <span class="n">particles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span>
            <span class="k">if</span> <span class="n">particles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No particles in voxelize. Run pack first.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">simbox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">simbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simbox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtSetDict</span><span class="p">,</span> \
        <span class="bp">self</span><span class="o">.</span><span class="n">vox_centerDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span> <span class="o">=</span> \
            <span class="n">voxelizationRoutine</span><span class="p">(</span><span class="n">particle_data</span><span class="p">,</span> <span class="n">RVE_data</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">simbox</span><span class="p">,</span>
                                <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="n">vf</span><span class="p">,</span>
                                <span class="n">save_files</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span>
        <span class="n">Ngr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elmtSetDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span> <span class="o">!=</span> <span class="n">Ngr</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of grains has changed from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">Ngr</span><span class="si">}</span><span class="s1"> during voxelization.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span> <span class="o">=</span> <span class="n">Ngr</span></div>


<div class="viewcode-block" id="Microstructure.smoothen">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.smoothen">[docs]</a>
    <span class="k">def</span> <span class="nf">smoothen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes_v</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elmtDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elmtSetDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates smoothed grain boundary from a voxelated mesh.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nodes_v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nodes_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span>
            <span class="k">if</span> <span class="n">nodes_v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No nodes_v in smoothen. Run voxelize first.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elmtDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elmtDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtDict</span>
        <span class="k">if</span> <span class="n">elmtSetDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elmtSetDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtSetDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span> <span class="o">=</span> \
            <span class="n">smoothingRoutine</span><span class="p">(</span><span class="n">nodes_v</span><span class="p">,</span> <span class="n">elmtDict</span><span class="p">,</span> <span class="n">elmtSetDict</span><span class="p">,</span>
                             <span class="n">save_files</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.generate_grains">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.generate_grains">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_grains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Writes out the particle- and grain diameter attributes for </span>
<span class="sd">        statistical comparison. Final RVE grain volumes and shared grain</span>
<span class="sd">        boundary surface areas info are written out as well.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No information about voxelized microstructure. Run voxelize first.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No phases defined.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_area</span> <span class="o">=</span> \
            <span class="n">calcPolygons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtSetDict</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">elmtDict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">vox_centerDict</span><span class="p">,</span>
                         <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">)</span>  <span class="c1"># updates RVE_data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">res_data</span> <span class="o">=</span> \
                <span class="n">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particle_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">nphase</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">,</span>
                          <span class="n">phase_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="s1">&#39;Phase number&#39;</span><span class="p">])</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --------     Plotting methods          --------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Microstructure.plot_ellipsoids">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.plot_ellipsoids">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_ellipsoids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates plot of particles&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No particle to plot. Run pack first.&#39;</span><span class="p">)</span>
        <span class="n">plot_ellipsoids_3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.plot_voxels">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.plot_voxels">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_voxels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sliced</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">porous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generate 3D plot of grains in voxelized microstructure. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No voxels or elements to plot. Run voxelize first.&#39;</span><span class="p">)</span>
        <span class="n">plot_voxels_3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span><span class="p">,</span> <span class="n">Ngr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">,</span>
                       <span class="n">sliced</span><span class="o">=</span><span class="n">sliced</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">,</span> <span class="n">porous</span><span class="o">=</span><span class="n">porous</span><span class="p">,</span>
                       <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.plot_grains">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.plot_grains">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_grains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rve</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;prism&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                    <span class="n">ec</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Plot polygonalized microstructure&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rve</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Grains&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">rve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No polygons for grains defined. Run analyse_RVE first&#39;</span><span class="p">)</span>
        <span class="n">plot_polygons_3D</span><span class="p">(</span><span class="n">rve</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span>
                         <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.plot_stats">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.plot_stats">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gs_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gs_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">ar_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ar_param</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Plots the particle- and grain diameter attributes for statistical </span>
<span class="sd">        comparison.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_data</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No microstructure data created yet. Run analyse_RVE first.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">plot_output_stats</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">gs_data</span><span class="o">=</span><span class="n">gs_data</span><span class="p">,</span> <span class="n">gs_param</span><span class="o">=</span><span class="n">gs_param</span><span class="p">,</span>
                              <span class="n">ar_data</span><span class="o">=</span><span class="n">ar_data</span><span class="p">,</span> <span class="n">ar_param</span><span class="o">=</span><span class="n">ar_param</span><span class="p">,</span>
                              <span class="n">save_files</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.plot_slice">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.plot_slice">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a slice through the microstructure.</span>
<span class="sd">        </span>
<span class="sd">        If polygonalized microstructure is available, it will be used as data </span>
<span class="sd">        basis, otherwise or if data=&#39;voxels&#39; the voxelized microstructure </span>
<span class="sd">        will be plotted.</span>
<span class="sd">        </span>
<span class="sd">        This subroutine calls the output_ang function with plotting active </span>
<span class="sd">        and writing of ang file deactivated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cut : str, optional</span>
<span class="sd">            Define cutting plane of slice as &#39;xy&#39;, &#39;xz&#39; or &#39;yz&#39;. The default is &#39;xy&#39;.</span>
<span class="sd">        data : str, optional</span>
<span class="sd">            Define data basis for plotting as &#39;voxels&#39; or &#39;poly&#39;. The default is None.</span>
<span class="sd">        pos : str or float</span>
<span class="sd">            Position in which slice is taken, either as absolute value, or as </span>
<span class="sd">            one of &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;. The default is None.</span>
<span class="sd">        fname : str, optional</span>
<span class="sd">            Filename of PDF file. The default is None.</span>
<span class="sd">        save_files : bool, optional</span>
<span class="sd">            Indicate if figure file is saved and PDF. The default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_ang</span><span class="p">(</span><span class="n">cut</span><span class="o">=</span><span class="n">cut</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">,</span>
                        <span class="n">save_plot</span><span class="o">=</span><span class="n">save_files</span><span class="p">)</span></div>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --------        Output/Export methods        --------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Microstructure.output_abq">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.output_abq">[docs]</a>
    <span class="k">def</span> <span class="nf">output_abq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">elmtDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elmtSetDict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">thermal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Writes out the Abaqus (.inp) file for the generated RVE.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning: No information about nodes is given, will write smoothened structure&#39;</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_s</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span>
                <span class="n">ntag</span> <span class="o">=</span> <span class="s1">&#39;smooth&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning: No information about nodes is given, will write voxelized structure&#39;</span><span class="p">)</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">ntag</span> <span class="o">=</span> <span class="s1">&#39;voxels&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No information about voxelized microstructure. Run voxelize first.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nodes</span> <span class="o">==</span> <span class="s1">&#39;smooth&#39;</span> <span class="ow">or</span> <span class="n">nodes</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_s</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grain_facesDict</span>
                <span class="n">ntag</span> <span class="o">=</span> <span class="s1">&#39;smooth&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No information about smoothed microstructure. Run smoothen first.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nodes</span> <span class="o">==</span> <span class="s1">&#39;voxels&#39;</span> <span class="ow">or</span> <span class="n">nodes</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span>
                <span class="n">faces</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">ntag</span> <span class="o">=</span> <span class="s1">&#39;voxels&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No information about voxelized microstructure. Run voxelize first.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">elmtDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elmtDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtDict</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Units&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">units</span><span class="o">==</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">units</span><span class="o">==</span><span class="s1">&#39;um&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Units must be either &quot;mm&quot; or &quot;um&quot;, not </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dual_phase</span><span class="p">:</span>
            <span class="n">nct</span> <span class="o">=</span> <span class="s1">&#39;2phases&#39;</span>
            <span class="n">Nvox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberX&#39;</span><span class="p">]</span> <span class="o">*</span>\
                   <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberY&#39;</span><span class="p">]</span> <span class="o">*</span>\
                   <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberZ&#39;</span><span class="p">]</span>
            <span class="n">elmt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nvox</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="n">ind1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">elmt_list</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">elmt_list</span><span class="o">==</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">elmtSetDict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="mi">1</span> <span class="p">:</span> <span class="n">ind1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="mi">2</span> <span class="p">:</span> <span class="n">ind2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">grains&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elmtSetDict</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">elmtSetDict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">elmtSetDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtSetDict</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/kanapy_</span><span class="si">{0}</span><span class="s1">_</span><span class="si">{1}</span><span class="s1">.inp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nct</span><span class="p">,</span> <span class="n">ntag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># remove old file if it exists</span>
        <span class="n">export2abaqus</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">elmtSetDict</span><span class="p">,</span> <span class="n">elmtDict</span><span class="p">,</span>
                      <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">grain_facesDict</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span>
                      <span class="n">dual_phase</span><span class="o">=</span><span class="n">dual_phase</span><span class="p">,</span> <span class="n">thermal</span><span class="o">=</span><span class="n">thermal</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span></div>


    <span class="c1"># def output_neper(self, timestep=None):</span>
<div class="viewcode-block" id="Microstructure.output_neper">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.output_neper">[docs]</a>
    <span class="k">def</span> <span class="nf">output_neper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Writes out particle position and weights files required for</span>
<span class="sd">        tessellation in Neper.&quot;&quot;&quot;</span>
        <span class="c1"># write_position_weights(timestep)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No particle to plot. Run pack first.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing position and weights files for NEPER&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">par_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">pa</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">z</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">a</span>
            <span class="n">par_dict</span><span class="p">[</span><span class="n">pa</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sphere_positions.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">par_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sphere_weights.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">par_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----&gt;DONE!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Microstructure.output_ang">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.output_ang">[docs]</a>
    <span class="k">def</span> <span class="nf">output_ang</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">matname</span><span class="o">=</span><span class="s1">&#39;XXXX&#39;</span><span class="p">,</span> <span class="n">save_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert orientation information of microstructure into a .ang file,</span>
<span class="sd">        mimicking an EBSD map.</span>
<span class="sd">        If polygonalized microstructure is available, it will be used as data </span>
<span class="sd">        basis, otherwise or if data=&#39;voxels&#39; the voxelized microstructure </span>
<span class="sd">        will be exported.</span>
<span class="sd">        If no orientations are provided, each grain will get a random </span>
<span class="sd">        Euler angle.</span>
<span class="sd">        Values in ANG file:</span>
<span class="sd">        phi1 Phi phi2 X Y imageQuality confidenseIndex phase semSignal Fit(/mad)</span>
<span class="sd">        Output of ang file can be deactivated if called for plotting of slice.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ori : (self.Ngr,)-array, optional</span>
<span class="sd">            Euler angles of grains. The default is None.</span>
<span class="sd">        cut : str, optional</span>
<span class="sd">            Define cutting plane of slice as &#39;xy&#39;, &#39;xz&#39; or &#39;yz&#39;. The default is &#39;xy&#39;.</span>
<span class="sd">        data : str, optional</span>
<span class="sd">            Define data basis for plotting as &#39;voxels&#39; or &#39;poly&#39;. The default is None.</span>
<span class="sd">        plot : bool, optional</span>
<span class="sd">            Indicate if slice is plotted. The default is True.</span>
<span class="sd">        pos : str or float</span>
<span class="sd">            Position in which slice is taken, either as absolute value, or as </span>
<span class="sd">            one of &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;. The default is None.</span>
<span class="sd">        cs : str, Optional</span>
<span class="sd">            Crystal symmetry. Default is None</span>
<span class="sd">        fname : str, optional</span>
<span class="sd">            Filename of ang file. The default is None.</span>
<span class="sd">        matname : str, optional</span>
<span class="sd">            Name of the material to be written in ang file. The default is &#39;XXXX&#39;</span>
<span class="sd">        save_files : bool, optional</span>
<span class="sd">            Indicate if ang file is saved, The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fname : str</span>
<span class="sd">            Name of ang file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cut</span> <span class="o">=</span> <span class="n">cut</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="n">sizeX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeX&#39;</span><span class="p">]</span>
            <span class="n">sizeY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeY&#39;</span><span class="p">]</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionX&#39;</span><span class="p">]</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionY&#39;</span><span class="p">]</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionZ&#39;</span><span class="p">]</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberX&#39;</span><span class="p">])</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberY&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberZ&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span> <span class="o">/</span> <span class="n">sz</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;pos&quot; must be either float or &quot;top&quot;, &quot;bottom&quot;, &quot;left&quot; or &quot;right&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">)</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;x ($\mu$m)&#39;</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;y ($\mu$m)&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;XY slice at z=</span><span class="si">{}</span><span class="s1"> $\mu$m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xz&#39;</span><span class="p">:</span>
            <span class="n">sizeX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeX&#39;</span><span class="p">]</span>
            <span class="n">sizeY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeZ&#39;</span><span class="p">]</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionX&#39;</span><span class="p">]</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionZ&#39;</span><span class="p">]</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionY&#39;</span><span class="p">]</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberX&#39;</span><span class="p">])</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberZ&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberY&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span> <span class="o">/</span> <span class="n">sy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;pos&quot; must be either float or &quot;top&quot;, &quot;bottom&quot;, &quot;left&quot; or &quot;right&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">)</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;x ($\mu$m)&#39;</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;z ($\mu$m)&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;XZ slice at y=</span><span class="si">{}</span><span class="s1"> $\mu$m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;yz&#39;</span><span class="p">:</span>
            <span class="n">sizeX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeY&#39;</span><span class="p">]</span>
            <span class="n">sizeY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeZ&#39;</span><span class="p">]</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionY&#39;</span><span class="p">]</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionZ&#39;</span><span class="p">]</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_resolutionX&#39;</span><span class="p">]</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberY&#39;</span><span class="p">])</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberZ&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Voxel_numberX&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span> <span class="o">/</span> <span class="n">sx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;pos&quot; must be either float or &quot;top&quot;, &quot;bottom&quot;, &quot;left&quot; or &quot;right&quot;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">)</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;y ($\mu$m)&#39;</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;z ($\mu$m)&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;YZ slice at x=</span><span class="si">{}</span><span class="s1"> $\mu$m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;cut&quot; must bei either &quot;xy&quot;, &quot;xz&quot; or &quot;yz&quot;.&#39;</span><span class="p">)</span>
        <span class="c1"># ANG file header</span>
        <span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;# TEM_PIXperUM          1.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# x-star                0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# y-star                0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# z-star                0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# WorkingDistance       0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# Phase 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# MaterialName  	</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">matname</span><span class="p">),</span>
                <span class="s1">&#39;# Formula</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# Info</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# Symmetry              m-3m</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# LatticeConstants       4.050 4.050 4.050  90.000  90.000  90.000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# NumberFamilies        0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# ElasticConstants 	0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# ElasticConstants 	0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# ElasticConstants 	0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# ElasticConstants 	0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# ElasticConstants 	0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# ElasticConstants 	0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# Categories0 0 0 0 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# GRID: SqrGrid</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# XSTEP: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
                <span class="s1">&#39;# YSTEP: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">sy</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
                <span class="s1">&#39;# NCOLS_ODD: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ix</span><span class="p">),</span>
                <span class="s1">&#39;# NCOLS_EVEN: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ix</span><span class="p">),</span>
                <span class="s1">&#39;# NROWS: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iy</span><span class="p">),</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# OPERATOR: 	Administrator</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# SAMPLEID:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;# SCANID:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;#</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="p">]</span>

        <span class="c1"># determine whether polygons or voxels shall be exported</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Grains&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;poly&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Neither polygons nor voxels for grains are present.</span><span class="se">\</span>
<span class="s1">                                 </span><span class="se">\n</span><span class="s1">Run voxelize and analyze_RVE first&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;voxels&#39;</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="o">!=</span> <span class="s1">&#39;voxels&#39;</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">!=</span> <span class="s1">&#39;poly&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;data&quot; must be either &quot;voxels&quot; or &quot;poly&quot;.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;voxels&#39;</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39; (Voxels)&#39;</span>
            <span class="k">if</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                <span class="n">g_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iz</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xz&#39;</span><span class="p">:</span>
                <span class="n">g_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="p">[:,</span> <span class="n">iz</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">g_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="p">[</span><span class="n">iz</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dual_phase</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                    <span class="n">g_slice_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">iz</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xz&#39;</span><span class="p">:</span>
                    <span class="n">g_slice_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span><span class="p">[:,</span> <span class="n">iz</span><span class="p">,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">g_slice_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span><span class="p">[</span><span class="n">iz</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39; (Polygons)&#39;</span>
            <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ix</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span> <span class="n">iy</span> <span class="o">*</span> <span class="n">sy</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
            <span class="n">grain_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">iy</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                <span class="n">mesh_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xv</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">grain_slice</span> <span class="o">*</span> <span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="k">elif</span> <span class="n">cut</span> <span class="o">==</span> <span class="s1">&#39;xz&#39;</span><span class="p">:</span>
                <span class="n">mesh_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xv</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">grain_slice</span> <span class="o">*</span> <span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="n">yv</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mesh_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grain_slice</span> <span class="o">*</span> <span class="n">iz</span> <span class="o">*</span> <span class="n">sz</span><span class="p">,</span> <span class="n">xv</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yv</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">grain_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">iy</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">igr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Grains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Grains&#39;</span><span class="p">][</span><span class="n">igr</span><span class="p">][</span><span class="s1">&#39;Points&#39;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">find_simplex</span><span class="p">(</span><span class="n">mesh_slice</span><span class="p">)</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">grain_slice</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">igr</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Grain #</span><span class="si">{}</span><span class="s1"> has no convex hull (Nvertices: </span><span class="si">{}</span><span class="s1">)&#39;</span> \
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">igr</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">grain_slice</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">grain_slice</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Incomplete slicing for </span><span class="si">{}</span><span class="s1"> pixels in </span><span class="si">{}</span><span class="s1"> slice at </span><span class="si">{}</span><span class="s1">.&#39;</span> \
                              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="n">cut</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span>
            <span class="n">g_slice</span> <span class="o">=</span> <span class="n">grain_slice</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xv</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ori</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">ori</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">ori</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">ori</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="c1"># write data to ang file</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">_slice_</span><span class="si">{1}</span><span class="s1">_</span><span class="si">{2}</span><span class="s1">.ang&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cut</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pos</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">iy</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ix</span><span class="p">:</span>
                        <span class="n">p1</span> <span class="o">=</span> <span class="n">ori</span><span class="p">[</span><span class="n">g_slice</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">P</span> <span class="o">=</span> <span class="n">ori</span><span class="p">[</span><span class="n">g_slice</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">p2</span> <span class="o">=</span> <span class="n">ori</span><span class="p">[</span><span class="n">g_slice</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  </span><span class="si">{0}</span><span class="s1">  </span><span class="si">{1}</span><span class="s1">  </span><span class="si">{2}</span><span class="s1">  </span><span class="si">{3}</span><span class="s1">  </span><span class="si">{4}</span><span class="s1">   0.0  0.000  0   1  0.000</span><span class="se">\n</span><span class="s1">&#39;</span> \
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                        <span class="nb">round</span><span class="p">(</span><span class="n">sizeX</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">sx</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">sizeY</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="n">sy</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="c1"># plot grains on slice</span>
            <span class="c1"># cmap = plt.cm.get_cmap(&#39;gist_rainbow&#39;)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;prism&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">g_slice</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                      <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">sizeX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizeY</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xl</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">yl</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">save_plot</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">dual_phase</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">g_slice_phase</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                          <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">sizeX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizeY</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xl</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">yl</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">save_plot</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="Microstructure.write_stl">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.write_stl">[docs]</a>
    <span class="k">def</span> <span class="nf">write_stl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Write triangles of convex polyhedra forming grains in form of STL</span>
<span class="sd">        files in the format</span>
<span class="sd">        &#39;</span>
<span class="sd">        solid name</span>
<span class="sd">          facet normal n1 n2 n3</span>
<span class="sd">            outer loop</span>
<span class="sd">              vertex p1x p1y p1z</span>
<span class="sd">              vertex p2x p2y p2z</span>
<span class="sd">              vertex p3x p3y p3z</span>
<span class="sd">            endloop</span>
<span class="sd">          endfacet</span>
<span class="sd">        endsolid name</span>
<span class="sd">        &#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Microstructure&#39;</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;px_</span><span class="si">{}</span><span class="s1">grains.stl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.stl&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;solid </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Facets&#39;</span><span class="p">]:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Points&#39;</span><span class="p">][</span><span class="n">ft</span><span class="p">]</span>
                <span class="n">nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># facet normal</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-5</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Acute facet detected. Facet: </span><span class="si">{</span><span class="n">ft</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-5</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Irregular facet detected. Facet: </span><span class="si">{</span><span class="n">ft</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">nv</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; facet normal </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; outer loop</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   vertex </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   vertex </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;   vertex </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  endloop</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; endfacet</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;endsolid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="Microstructure.write_centers">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.write_centers">[docs]</a>
    <span class="k">def</span> <span class="nf">write_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grains</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Microstructure&#39;</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;px_</span><span class="si">{}</span><span class="s1">grains_centroid.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_centroid.csv&#39;</span>
        <span class="k">if</span> <span class="n">grains</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grains</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Grains&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gr</span> <span class="ow">in</span> <span class="n">grains</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c1"># if polyhedral grain has no simplices, center should not be written!!!</span>
                <span class="n">ctr</span> <span class="o">=</span> <span class="n">gr</span><span class="p">[</span><span class="s1">&#39;Center&#39;</span><span class="p">]</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ctr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ctr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ctr</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Microstructure.write_ori">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.write_ori">[docs]</a>
    <span class="k">def</span> <span class="nf">write_ori</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Microstructure&#39;</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;px_</span><span class="si">{}</span><span class="s1">grains_ori.csv&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_ori.csv&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ori</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ori</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ori</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ori</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Microstructure.write_voxels">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.write_voxels">[docs]</a>
    <span class="k">def</span> <span class="nf">write_voxels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sname</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dual_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write voxel structure into JSON file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sname</span>
<span class="sd">        file</span>
<span class="sd">        path</span>
<span class="sd">        mesh</span>
<span class="sd">        source</span>
<span class="sd">        dual_phase</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">platform</span>
        <span class="kn">import</span> <span class="nn">getpass</span>
        <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
        <span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">get_distribution</span>
        <span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dump</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Microstructure&#39;</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;px_</span><span class="si">{}</span><span class="s1">grains_voxels.json&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_voxels.json&#39;</span>
        <span class="c1"># metadata</span>
        <span class="n">today</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>  <span class="c1"># date</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>  <span class="c1"># username</span>
        <span class="n">sys_info</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>  <span class="c1"># system information</span>
        <span class="k">if</span> <span class="n">dual_phase</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">data_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels_phase</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>  <span class="c1"># item() converts numpy-int64 to python int</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Info&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Owner&quot;</span><span class="p">:</span> <span class="n">owner</span><span class="p">,</span>
                <span class="s2">&quot;Institution&quot;</span><span class="p">:</span> <span class="s2">&quot;ICAMS, Ruhr University Bochum, Germany&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Date&quot;</span><span class="p">:</span> <span class="n">today</span><span class="p">,</span>
                <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="s2">&quot;Voxels of microstructure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Method&quot;</span><span class="p">:</span> <span class="s2">&quot;Synthetic microstructure generator Kanapy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;System&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;sysname&quot;</span><span class="p">:</span> <span class="n">sys_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;nodename&quot;</span><span class="p">:</span> <span class="n">sys_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;release&quot;</span><span class="p">:</span> <span class="n">sys_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">sys_info</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s2">&quot;machine&quot;</span><span class="p">:</span> <span class="n">sys_info</span><span class="p">[</span><span class="mi">4</span><span class="p">]},</span>
            <span class="p">},</span>
            <span class="s2">&quot;Model&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Creator&quot;</span><span class="p">:</span> <span class="s2">&quot;kanapy&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="n">get_distribution</span><span class="p">(</span><span class="s1">&#39;kanapy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                <span class="s2">&quot;Repository&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/ICAMS/Kanapy.git&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Input&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;Script&quot;</span><span class="p">:</span> <span class="n">sname</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;Data&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Class&quot;</span> <span class="p">:</span> <span class="s1">&#39;phase_numbers&#39;</span><span class="p">,</span>
                <span class="s2">&quot;Type&quot;</span>  <span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span>
                <span class="s2">&quot;Shape&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxels</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s2">&quot;Order&quot;</span> <span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span>
                <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="n">data_values</span><span class="p">,</span>
                <span class="s2">&quot;Geometry&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeX&#39;</span><span class="p">],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeY&#39;</span><span class="p">],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;RVE_sizeZ&#39;</span><span class="p">]),</span>
                <span class="s2">&quot;Units&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;Length&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Units&#39;</span><span class="p">],</span>
                    <span class="p">},</span>
                <span class="s2">&quot;Periodicity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RVE_data</span><span class="p">[</span><span class="s1">&#39;Periodic&#39;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">mesh</span><span class="p">:</span>
            <span class="n">nout</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span><span class="p">:</span>
                <span class="n">nout</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">])</span>
            <span class="n">structure</span><span class="p">[</span><span class="s1">&#39;Mesh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Nodes&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Class&quot;</span> <span class="p">:</span> <span class="s1">&#39;coordinates&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;Type&quot;</span>  <span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;Shape&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_v</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="s2">&quot;Values&quot;</span>  <span class="p">:</span> <span class="n">nout</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;Voxels&quot;</span> <span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Class&quot;</span> <span class="p">:</span> <span class="s1">&#39;node_list&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;Type&quot;</span>  <span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;Shape&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elmtDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="mi">8</span><span class="p">),</span>
                    <span class="s2">&quot;Values&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elmtDict</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">dump</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Microstructure.pckl">
<a class="viewcode-back" href="../../kanapy.html#kanapy.api.Microstructure.pckl">[docs]</a>
    <span class="k">def</span> <span class="nf">pckl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write microstructure into pickle file. Usefull for to store complex structures.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : string (optional, default: None)</span>
<span class="sd">            File name for pickled microstructure. The default is None, in which case</span>
<span class="sd">            the filename will be the microstructure name + &#39;.pckl&#39;.</span>
<span class="sd">        path : string</span>
<span class="sd">            Path to location for pickles</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">pickle</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Microstructure&#39;</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;px_</span><span class="si">{}</span><span class="s1">grains_microstructure.pckl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ngr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_microstructure.pckl&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
        <span class="k">return</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This work is published under a CC BY-SA 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>