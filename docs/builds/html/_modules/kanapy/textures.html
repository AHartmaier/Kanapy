<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>kanapy.textures &mdash; kanapy 6.3.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=a3796ccd"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            kanapy
          </a>
              <div class="version">
                6.3.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../method.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kanapy.html">Code documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">kanapy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">kanapy.textures</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for kanapy.textures</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tools for analysis of EBSD maps in form of .ang files</span>

<span class="sd">@author: Alexander Hartmaier, Abhishek Biswas, ICAMS, Ruhr-Universit√§t Bochum</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matlab.engine</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">kanapy.util</span> <span class="kn">import</span> <span class="n">MTEX_DIR</span><span class="p">,</span> <span class="n">ROOT_DIR</span><span class="p">,</span> <span class="n">MAIN_DIR</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">vonmises</span>
<span class="kn">import</span> <span class="nn">logging</span>


<div class="viewcode-block" id="EBSDmap">
<a class="viewcode-back" href="../../kanapy.html#kanapy.textures.EBSDmap">[docs]</a>
<span class="k">class</span> <span class="nc">EBSDmap</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to store attributes and methods to import EBSD maps</span>
<span class="sd">    and filter out their statistical data needed to generate</span>
<span class="sd">    synthetic RVEs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">matname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gs_min</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">vf_min</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate microstructural data from EBSD maps</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fname : str</span>
<span class="sd">            filname incl. path to EBSD file.</span>
<span class="sd">        matname : str, optional</span>
<span class="sd">            Name of material, depracted. The default is None.</span>
<span class="sd">        gs_min : int, optional</span>
<span class="sd">            Minimum grain size in pixels, smaller grains will be disregarded</span>
<span class="sd">            for the statistical analysis. The default is 3.</span>
<span class="sd">        vf_min : int, optional</span>
<span class="sd">            Minimum volume fracture, phases with smaller values will be</span>
<span class="sd">            disregarded. The default is 0.03.</span>
<span class="sd">        plot : bool, optional</span>
<span class="sd">            Plot microstructures. The default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">        </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        ms_data : list of dict</span>
<span class="sd">            List of dictionaries with phase specific microstructure</span>
<span class="sd">            information.  </span>
<span class="sd">            name : name of phase  </span>
<span class="sd">            vf : volume fraction</span>
<span class="sd">            ngrain : number of grains in phase</span>
<span class="sd">            ori : matlab object with grain orientations</span>
<span class="sd">            cs : matlab object with crystal structure</span>
<span class="sd">            grains : matlab object with grains in each phase</span>
<span class="sd">            omega : orintations of major grain axis</span>
<span class="sd">            gs_param : statistical grain size parameters</span>
<span class="sd">            gs_data : grain sizesvonmises</span>
<span class="sd">            ar_param</span>
<span class="sd">            ar_data</span>
<span class="sd">            om_param</span>
<span class="sd">            om_data</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">        eng : handle for Matlab engine with MTEX data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">matname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Use of parameter &quot;matname&quot; is depracted.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hist</span> <span class="o">=</span> <span class="n">plot</span>
        <span class="c1"># start MATLAB Engine to use MTEX commands</span>
        <span class="n">eng</span> <span class="o">=</span> <span class="n">matlab</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">start_matlab</span><span class="p">()</span>
        <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">MTEX_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">ROOT_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mat_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;kanapy&#39;</span><span class="p">)</span>
        <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">mat_path</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">eng</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eng</span> <span class="o">=</span> <span class="n">eng</span>

        <span class="c1"># read EBSD map and return the matlab.object of MTEX class EBSD</span>
        <span class="n">ebsd_full</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">EBSD</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;convertSpatial2EulerReferenceFrame&#39;</span><span class="p">,</span> <span class="s1">&#39;setting 2&#39;</span><span class="p">)</span>
        <span class="c1"># remove not indexed pixels</span>
        <span class="n">eng</span><span class="o">.</span><span class="n">workspace</span><span class="p">[</span><span class="s2">&quot;ebsd_w&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebsd_full</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">eng</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ebsd_full</span><span class="p">)</span>
        <span class="n">ebsd</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ebsd_w(&#39;indexed&#39;)&quot;</span><span class="p">)</span>  <span class="c1"># select only indexed pixels in EBSD</span>
        <span class="n">eng</span><span class="o">.</span><span class="n">workspace</span><span class="p">[</span><span class="s2">&quot;ebsd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ebsd</span>
        <span class="c1"># get list of phases at each pixel in EBSD map</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">ebsd</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">))[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># determine number of phases and generate histogram</span>
        <span class="n">Nphase</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">plist</span><span class="p">))</span>
        <span class="n">npx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">plist</span><span class="p">)</span>  <span class="c1"># total number of pixels in EBSD map</span>
        <span class="n">phist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">Nphase</span><span class="p">)</span>
        <span class="c1"># read phase names and calculate volume fractions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nphase</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># initialize data dictionary</span>
            <span class="c1"># generate phase-specific ebsd object in MTEX</span>
            <span class="n">ebsd_h</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ebsd(&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">ebsd_h</span><span class="p">,</span> <span class="s1">&#39;mineral&#39;</span><span class="p">)</span>
            <span class="n">vf</span> <span class="o">=</span> <span class="n">phist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">npx</span>
            <span class="k">if</span> <span class="n">vf</span> <span class="o">&lt;</span> <span class="n">vf_min</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vf</span>

            <span class="c1"># Texture analysis: orientation set from the EBSD</span>
            <span class="n">ori0</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">ebsd_h</span><span class="p">,</span> <span class="s1">&#39;orientations&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ori&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">project2FundamentalRegion</span><span class="p">(</span><span class="n">ori0</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;cs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">ebsd_h</span><span class="p">,</span> <span class="s1">&#39;CS&#39;</span><span class="p">)</span>
            <span class="c1"># analyze grain boundaries with MTEX function</span>
            <span class="n">grains_full</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">calcGrains</span><span class="p">(</span><span class="n">ebsd_h</span><span class="p">,</span> <span class="s1">&#39;boundary&#39;</span><span class="p">,</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">,</span>
                                         <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">))</span>
            <span class="c1"># filter out small grains</span>
            <span class="n">eng</span><span class="o">.</span><span class="n">workspace</span><span class="p">[</span><span class="s2">&quot;grains_w&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grains_full</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;grains_w(grains_w.grainSize &gt; </span><span class="si">{}</span><span class="s2">)&quot;</span>
                                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gs_min</span><span class="p">))</span>

            <span class="c1"># use MTEX function to analyze grains and plot ellipses around grain</span>
            <span class="c1"># centres; calculate orientation, long and short axes of ellipses</span>
            <span class="n">omega_r</span><span class="p">,</span> <span class="n">ha</span><span class="p">,</span> <span class="n">hb</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">principalComponents</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">],</span>
                                                      <span class="n">nargout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">omega_r</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ngrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="c1"># plot EBSD map</span>
                <span class="n">eng</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ebsd_h</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ori&#39;</span><span class="p">])</span>
                <span class="n">eng</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># plot grain boundaries into EBSD map</span>
                <span class="n">eng</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">],</span> <span class="s1">&#39;boundary&#39;</span><span class="p">),</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span>
                         <span class="s1">&#39;micronbar&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span>
                <span class="c1"># evalute centres of grains</span>
                <span class="n">centres</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">getfield</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">],</span> <span class="s1">&#39;centroid&#39;</span><span class="p">)</span>
                <span class="n">eng</span><span class="o">.</span><span class="n">plotEllipse</span><span class="p">(</span><span class="n">centres</span><span class="p">,</span> <span class="n">ha</span><span class="p">,</span> <span class="n">hb</span><span class="p">,</span> <span class="n">omega_r</span><span class="p">,</span> <span class="s1">&#39;lineColor&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">eng</span><span class="o">.</span><span class="n">hold</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># eng.exportgraphics(gcf,&#39;ebsd_map.png&#39;,&#39;Resolution&#39;,300)</span>

<span class="w">                </span><span class="sd">&#39;&#39;&#39; ODF plotting produces system failure, use Matlab functions</span>
<span class="sd">                </span>
<span class="sd">                # plot ODF </span>
<span class="sd">                # estimate the ODF using KDE</span>
<span class="sd">                psi = eng.deLaValleePoussinKernel(&#39;halfwidth&#39;, 5*np.pi/180.)</span>
<span class="sd">                odf = eng.calcKernelODF(self.ori, &#39;kernel&#39;, psi)</span>
<span class="sd">                </span>
<span class="sd">                h = [eng.Miller(1, 0, 0, self.cs),</span>
<span class="sd">                     eng.Miller(1, 1, 0, self.cs),</span>
<span class="sd">                     eng.Miller(1, 1, 1, self.cs)]</span>
<span class="sd">                </span>
<span class="sd">                # plot pole figure</span>
<span class="sd">                try:</span>
<span class="sd">                    eng.plotPDF(odf,h,&#39;contourf&#39;, nargout=0)</span>
<span class="sd">                    eng.hold(&#39;on&#39;, nargout=0)</span>
<span class="sd">                    eng.mtexColorbar</span>
<span class="sd">                except:</span>
<span class="sd">                    logging.warning(&#39;ODF too large for plotting&#39;)</span>
<span class="sd">                # workaround:</span>
<span class="sd">                eng.workspace[&quot;ori&quot;] = data[&#39;ori&#39;]</span>
<span class="sd">                eng.workspace[&quot;cs&quot;] = data[&#39;cs&#39;]</span>
<span class="sd">                try:</span>
<span class="sd">                    eng.eval(f&quot;plotPDF(ori,Miller(0,0,1,cs),&#39;points&#39;,&#39;all&#39;)&quot;, nargout=0)</span>
<span class="sd">                except:</span>
<span class="sd">                    logging.warning(&#39;Plotting of orientations failed.&#39;)&#39;&#39;&#39;</span>
            <span class="c1"># Evaluate grain shape statistics</span>
            <span class="c1"># generate dict for statistical input for geometry module</span>

            <span class="c1"># grain equivalent diameter</span>
            <span class="n">deq</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">equivalentRadius</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">]))[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># dsig, doffs, dscale = lognorm.fit(deq)  # fit log normal distribution</span>
            <span class="n">doffs</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">deq_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">deq</span><span class="p">)</span>
            <span class="n">dscale</span> <span class="o">=</span> <span class="n">med_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">deq_log</span><span class="p">))</span>  <span class="c1"># lognorm.median(dsig, loc=doffs, scale=dscale)</span>
            <span class="n">dsig</span> <span class="o">=</span> <span class="n">std_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">deq_log</span><span class="p">)</span>  <span class="c1"># lognorm.std(dsig, loc=doffs, scale=dscale)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gs_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dsig</span><span class="p">,</span> <span class="n">doffs</span><span class="p">,</span> <span class="n">dscale</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gs_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deq</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gs_moments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">med_eq</span><span class="p">,</span> <span class="n">std_eq</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hist</span><span class="p">:</span>
                <span class="c1"># plot distribution of grain sizes</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">deq</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">deq</span><span class="p">),</span> <span class="mi">150</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dsig</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">doffs</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">dscale</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">deq</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of grain equivalent diameters&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Equivalent diameter (micron)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized frequency&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1"># grain aspect ratio</span>
            <span class="n">asp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">aspectRatio</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">]))[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># asig, aoffs, ascale = lognorm.fit(asp)  # fit log normal distribution</span>
            <span class="n">aoffs</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">asp_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">asp</span><span class="p">)</span>
            <span class="n">ascale</span> <span class="o">=</span> <span class="n">med_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">asp_log</span><span class="p">))</span>  <span class="c1"># lognorm.median(asig, loc=aoffs, scale=ascale)</span>
            <span class="n">asig</span> <span class="o">=</span> <span class="n">std_ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">asp_log</span><span class="p">)</span>  <span class="c1"># lognorm.std(asig, loc=aoffs, scale=ascale)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ar_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">asig</span><span class="p">,</span> <span class="n">aoffs</span><span class="p">,</span> <span class="n">ascale</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ar_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">asp</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ar_moments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">med_ar</span><span class="p">,</span> <span class="n">std_ar</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hist</span><span class="p">:</span>
                <span class="c1"># plot distribution of aspect ratios</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">asp</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">asp</span><span class="p">),</span> <span class="mi">150</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">asig</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">aoffs</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ascale</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit lognorm&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">asp</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of grain aspect ratio&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;aspect ratio&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;normalized frequency&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="c1"># angles of main axis</span>
            <span class="c1"># fit von Mises distribution (circular normal distribution) to data</span>
            <span class="n">omega_p</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">omega</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># rescale angles from [0, pi] to [-pi,pi] for von Mises distr. fit</span>
            <span class="n">kappa</span><span class="p">,</span> <span class="n">oloc</span><span class="p">,</span> <span class="n">oscale</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">omega_p</span><span class="p">)</span>
            <span class="n">med_om</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">oloc</span><span class="p">)</span>  <span class="c1"># scale parameter has no effect on vonmises distribution</span>
            <span class="n">std_om</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">oloc</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;om_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kappa</span><span class="p">,</span> <span class="n">oloc</span><span class="p">])</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;om_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omega_p</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;om_moments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">med_om</span><span class="p">,</span> <span class="n">std_om</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hist</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># np.amin(omega), np.amax(omega), 150)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">vonmises</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">oloc</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of tilt angles of major axes&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;angle (rad)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;normalized frequency&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analyzed microstructure with </span><span class="si">{}</span><span class="s1"> grains.&#39;</span>
                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ngrain&#39;</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Median values: equiv. diameter: </span><span class="si">{</span><span class="n">med_eq</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> micron, &#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;aspect ratio: </span><span class="si">{</span><span class="n">med_ar</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">, &#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;tilt angle: </span><span class="si">{</span><span class="p">(</span><span class="n">med_om</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">180</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">¬∞&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Std. dev: equivalent diameter: </span><span class="si">{</span><span class="n">std_eq</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> micron, &#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;aspect ratio: </span><span class="si">{</span><span class="n">std_ar</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">, &#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;tilt angle: </span><span class="si">{</span><span class="p">(</span><span class="n">std_om</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">180</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1">¬∞&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="EBSDmap.calcORI">
<a class="viewcode-back" href="../../kanapy.html#kanapy.textures.EBSDmap.calcORI">[docs]</a>
    <span class="k">def</span> <span class="nf">calcORI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ng</span><span class="p">,</span> <span class="n">iphase</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shared_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate optimum kernel half-width and produce reduced set of</span>
<span class="sd">        orientations for given number of grains.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Ng : int</span>
<span class="sd">            Numbr of grains for which orientation is requested.</span>
<span class="sd">        iphase : int, optional</span>
<span class="sd">            Phase for which data is requested. The default is 0.</span>
<span class="sd">        shared_area : array, optional</span>
<span class="sd">            Grain boundary data. The default is None.</span>
<span class="sd">        nbins : int, optional</span>
<span class="sd">            number of bins for GB texture. The default is 12.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ori : (Ng, 3)-array</span>
<span class="sd">            Array with Ng Euler angles.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_data</span><span class="p">[</span><span class="n">iphase</span><span class="p">]</span>
        <span class="n">orired</span><span class="p">,</span> <span class="n">odfred</span><span class="p">,</span> <span class="n">ero</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">textureReconstruction</span><span class="p">(</span><span class="n">Ng</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">,</span>
                                           <span class="n">ms</span><span class="p">[</span><span class="s1">&#39;ori&#39;</span><span class="p">],</span> <span class="s1">&#39;grains&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">],</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shared_area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">Euler</span><span class="p">(</span><span class="n">orired</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orilist</span><span class="p">,</span> <span class="n">ein</span><span class="p">,</span> <span class="n">eout</span><span class="p">,</span> <span class="n">mbin</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">gb_textureReconstruction</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s1">&#39;grains&#39;</span><span class="p">],</span> <span class="n">orired</span><span class="p">,</span>
                                                  <span class="n">matlab</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">shared_area</span><span class="p">),</span> <span class="n">nbins</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">Euler</span><span class="p">(</span><span class="n">orilist</span><span class="p">))</span></div>


<div class="viewcode-block" id="EBSDmap.showIPF">
<a class="viewcode-back" href="../../kanapy.html#kanapy.textures.EBSDmap.showIPF">[docs]</a>
    <span class="k">def</span> <span class="nf">showIPF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot IPF key.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_data</span><span class="p">:</span>
            <span class="n">ipfKey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">ipfColorKey</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="s1">&#39;ori&#39;</span><span class="p">],</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eng</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ipfKey</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
</div>

            
            
<div class="viewcode-block" id="get_ipf_colors">
<a class="viewcode-back" href="../../kanapy.html#kanapy.textures.get_ipf_colors">[docs]</a>
<span class="k">def</span> <span class="nf">get_ipf_colors</span><span class="p">(</span><span class="n">ori_list</span><span class="p">,</span> <span class="n">color_key</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get colors of list of orientations (in radians).</span>
<span class="sd">    Assumes cubic crystal symmetry and cubic specimen symmetry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ori_list: (N, 3) ndarray</span>
<span class="sd">        List of N Euler angles in radians</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    colors: (N, 3) ndarray</span>
<span class="sd">        List of RGB values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># start Matlab engine</span>
    <span class="n">eng</span> <span class="o">=</span> <span class="n">matlab</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">start_matlab</span><span class="p">()</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">MTEX_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">ROOT_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mat_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;kanapy&#39;</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">mat_path</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># get colors</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create possibility to pass CS to MTEX&quot;&quot;&quot;</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">get_ipf_col</span><span class="p">(</span><span class="n">ori_list</span><span class="p">,</span> <span class="n">color_key</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span></div>

        


<div class="viewcode-block" id="createOriset">
<a class="viewcode-back" href="../../kanapy.html#kanapy.textures.createOriset">[docs]</a>
<span class="k">def</span> <span class="nf">createOriset</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">cs</span><span class="o">=</span><span class="s1">&#39;m-3m&#39;</span><span class="p">,</span> <span class="n">Nbase</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a set of num Euler angles according to the ODF defined by the </span>
<span class="sd">    set of Euler angles ang and the kernel half-width omega.</span>
<span class="sd">    Example: Goss texture: ang = [0, 45, 0], omega = 5</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : int</span>
<span class="sd">        Number of Euler angles in set to be created.</span>
<span class="sd">    ang : (3, ) or (M, 3) array</span>
<span class="sd">        Set of Euler angles (in degrees) defining the ODF.</span>
<span class="sd">    omega : float</span>
<span class="sd">        Half-width of kernel in degrees.</span>
<span class="sd">    hist : array, optional</span>
<span class="sd">        Histogram of MDF. The default is None.</span>
<span class="sd">    shared_area: array, optional</span>
<span class="sd">        The shared area between pairs of grains. The default in None.</span>
<span class="sd">    cs : str, optional</span>
<span class="sd">        Crystal symmetry group. The default is &#39;m3m&#39;.</span>
<span class="sd">    Nbase : int, optional</span>
<span class="sd">        Base number of orientations for random texture. The default is 10000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ori : (num, 3) array</span>
<span class="sd">        Set of Euler angles</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># start Matlab engine</span>
    <span class="n">eng</span> <span class="o">=</span> <span class="n">matlab</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">start_matlab</span><span class="p">()</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">MTEX_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">ROOT_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mat_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;kanapy&#39;</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">mat_path</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># prepare parameters</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">omega</span> <span class="o">*=</span> <span class="n">deg</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">*</span> <span class="n">deg</span>
    <span class="n">cs_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">crystalSymmetry</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
    <span class="n">ori</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">orientation</span><span class="p">(</span><span class="s1">&#39;Euler&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                          <span class="nb">float</span><span class="p">(</span><span class="n">ang</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">cs_</span><span class="p">)</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">deLaValleePoussinKernel</span><span class="p">(</span><span class="s1">&#39;halfwidth&#39;</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
    <span class="n">odf</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">calcKernelODF</span><span class="p">(</span><span class="n">ori</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>

    <span class="c1"># create artificial EBSD</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">calcOrientations</span><span class="p">(</span><span class="n">odf</span><span class="p">,</span> <span class="n">Nbase</span><span class="p">)</span>
    <span class="n">ori</span><span class="p">,</span> <span class="n">odfred</span><span class="p">,</span> <span class="n">ero</span> <span class="o">=</span> \
        <span class="n">eng</span><span class="o">.</span><span class="n">textureReconstruction</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">Euler</span><span class="p">(</span><span class="n">ori</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">shared_area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Microstructure.shared_area must be provided if hist is given.&#39;</span><span class="p">)</span>
        <span class="n">orilist</span><span class="p">,</span> <span class="n">ein</span><span class="p">,</span> <span class="n">eout</span><span class="p">,</span> <span class="n">mbin</span> <span class="o">=</span> \
            <span class="n">eng</span><span class="o">.</span><span class="n">gb_textureReconstruction</span><span class="p">(</span><span class="n">matlab</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">hist</span><span class="p">),</span> <span class="n">ori</span><span class="p">,</span>
                                         <span class="n">matlab</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">shared_area</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">),</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">Euler</span><span class="p">(</span><span class="n">orilist</span><span class="p">))</span></div>



<div class="viewcode-block" id="createOrisetRandom">
<a class="viewcode-back" href="../../kanapy.html#kanapy.textures.createOrisetRandom">[docs]</a>
<span class="k">def</span> <span class="nf">createOrisetRandom</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">omega</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">cs</span><span class="o">=</span><span class="s1">&#39;m-3m&#39;</span><span class="p">,</span> <span class="n">Nbase</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a set of num Euler angles for Random texture. </span>
<span class="sd">    Other than knpy.createOriset() this method does not create an artificial</span>
<span class="sd">    EBSD which is reduced in a second step to num discrete orientations but </span>
<span class="sd">    directly samples num randomly distributed orientations.s</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : int</span>
<span class="sd">        Number of Euler angles in set to be created.</span>
<span class="sd">    omega : float</span>
<span class="sd">        Halfwidth of kernel in degrees (optional, default: 7.5)</span>
<span class="sd">    hist : array, optional</span>
<span class="sd">        Histogram of MDF. The default is None.</span>
<span class="sd">    shared_area: array, optional</span>
<span class="sd">        The shared area between pairs of grains. The default in None.</span>
<span class="sd">    cs : str, optional</span>
<span class="sd">        Crystal symmetry group. The default is &#39;m3m&#39;.</span>
<span class="sd">    Nbase : int, optional</span>
<span class="sd">        Base number of orientations for random texture. The default is 5000</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ori : (num, 3) array</span>
<span class="sd">        Set of Euler angles</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># start Matlab engine</span>
    <span class="n">eng</span> <span class="o">=</span> <span class="n">matlab</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">start_matlab</span><span class="p">()</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">MTEX_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">ROOT_DIR</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mat_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MAIN_DIR</span> <span class="o">+</span> <span class="s1">&#39;src&#39;</span> <span class="o">+</span> <span class="s1">&#39;kanapy&#39;</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">addpath</span><span class="p">(</span><span class="n">mat_path</span><span class="p">,</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eng</span><span class="o">.</span><span class="n">startup</span><span class="p">(</span><span class="n">nargout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">cs_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">crystalSymmetry</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
    <span class="n">ot</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Nbase</span><span class="p">,</span> <span class="n">cs_</span><span class="p">)</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">deLaValleePoussinKernel</span><span class="p">(</span><span class="s1">&#39;halfwidth&#39;</span><span class="p">,</span> <span class="n">omega</span><span class="p">)</span>
    <span class="n">ori</span><span class="p">,</span> <span class="n">odfred</span><span class="p">,</span> <span class="n">ero</span> <span class="o">=</span> \
        <span class="n">eng</span><span class="o">.</span><span class="n">textureReconstruction</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">,</span> <span class="n">ot</span><span class="p">,</span> <span class="s1">&#39;kernel&#39;</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span>
                                  <span class="n">nargout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># ori = eng.project2FundamentalRegion(ori)</span>
    <span class="k">if</span> <span class="n">hist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">Euler</span><span class="p">(</span><span class="n">ori</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">shared_area</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Shared grain boundary area (geometry[&quot;GBarea&quot;]) must be provided if hist is given.&#39;</span><span class="p">)</span>
        <span class="n">orilist</span><span class="p">,</span> <span class="n">ein</span><span class="p">,</span> <span class="n">eout</span><span class="p">,</span> <span class="n">mbin</span> <span class="o">=</span> \
            <span class="n">eng</span><span class="o">.</span><span class="n">gb_textureReconstruction</span><span class="p">(</span><span class="n">matlab</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">hist</span><span class="p">),</span> <span class="n">ori</span><span class="p">,</span>
                                         <span class="n">matlab</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">shared_area</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">hist</span><span class="p">),</span> <span class="n">nargout</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eng</span><span class="o">.</span><span class="n">Euler</span><span class="p">(</span><span class="n">orilist</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright This work is published under a CC BY-SA 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>